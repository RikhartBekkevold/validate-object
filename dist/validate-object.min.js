/* validate-object.js - copyright Rikhart Bekkevold. MIT license. Version 1.0.0. */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).validateObject=t()}(this,(function(){"use strict";var e={hasProto:function(e){return!!Object.getPrototypeOf(e)},protoIs:function(e,t){return Object.getPrototypeOf(e)===t}},t={validateNestedObjects:!0,exactKeys:!1,recursionLimit:1/0,useLooseValueCompare:!1,countBoxedPrimAsPrimValue:!1,validateObjectByConstructor:!1,strictTagCheck:!1},r={},n=Object.prototype.toString;r.normalizeString=function(e){return"string"==typeof e?e.toLowerCase():e},r.capitalize=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},r.getType=function(e){return n.call(e).slice(8,-1).toLowerCase()};const{hasProto:i}=e,{countBoxedPrimAsPrimValue:o,strictTagCheck:a}=t,{capitalize:s}=r;var u=Array.isArray,c=Number.isNaN,f=Number.isSafeInteger;function y(e){return a?u(e)&&g(e,"Array"):u(e)}function l(e){return y(e)||p(e)}function p(e){return ArrayBuffer.isView(e)}function b(e){return"object"==typeof e&&null!==e}function m(e){return"function"==typeof e}var d=Object.prototype.toString;function g(e,t){return d.call(e)==="[object "+t+"]"}function v(e){var t=["string","symbol","boolean","number","bigint"];return a?t.includes(typeof e)&&g(e,s(typeof e)):t.includes(typeof e)}function h(e){return Number.isInteger(e)}function O(e){return null!==e||void 0!==e}function w(e,t,r){return!!b(e)&&((!t||!i(e))&&(l(e)?!e.length:k(e)||S(e)?!e.size:!Object.keys(e).length))}function j(e){return!e}function k(e){try{return Set.prototype.has.call(e),!0}catch(e){return!1}}function S(e){try{return Map.prototype.has.call(e),!0}catch(e){return!1}}function A(e){return e.constructor===async function(){}.constructor}function E(e){return e.constructor===function*(){}.constructor}function P(e){return e.constructor===async function*(){}.constructor}function T(e){return function(t){return"object"==typeof t&&typeof t.valueOf()===e}}var N=T("string"),F=T("number"),x=T("bigint"),I=T("symbol");function B(e,t){if(!y(e))return!1;for(var r of e)if(!t(r))return!1;return!0}var V={isPlainObject:function(e){return"object"==typeof e&&!l(e)&&null!==e},isObject:b,isObjectOrFn:function(e){return"object"==typeof e||"function"==typeof e},isFunction:m,isBoolean:function(e){var t="boolean"==typeof e||o&&isBoxedBool(e);return a?t&&g(e,"Boolean"):t},isSymbol:function(e){var t="symbol"==typeof e||o&&I(e);return a?t&&g(e,"Symbol"):t},isNumber:function(e){var t="number"==typeof e||o&&F(e);return a?t&&g(e,"Number"):t},isValidNumber:function(e){return Number.isFinite(e)},isInfinite:function(e){return e===1/0||e===-1/0},isString:function(e){var t="string"==typeof e||o&&N(e);return a?t&&g(e,"String"):t},isBigInt:function(e){var t="bigint"==typeof e||o&&x(e);return a?t&&g(e,"BigInt"):t},isInt:h,isFloat:function(e){return!h(e)},isArray:y,isNaN:c,isNotDefined:function(e){return!O(e)},isFalsy:j,isSet:k,isWeakSet:function(e){return e instanceof WeakSet},isMap:S,isWeakMap:function(e){return e instanceof WeakMap},isEmptyObj:w,isEmptyVal:function(e,t){return j(e)&&w(e,t)},isTypedArray:p,isAnyArray:l,isRegExp:function(e){return e instanceof RegExp},isAnonymousFunction:function(e){return"function"==typeof e&&""===e.name},isAsyncFunction:A,isGeneratorFunction:E,isAsyncGeneratorFunction:P,isPrimitive:v,isSafeInteger:f,isArrayOfPrimType:e=>B(e,(e=>typeof e)),isPrimArray:e=>B(e,v),isPlainFunction:function(e){return m(e)&&!A(e)&&!E(e)&&!P(e)},isDefined:O,isTruthy:function(e){return!!e}};const{isFunction:C,isPlainObject:K,isString:M,isBoolean:z,isSymbol:D,isNumber:L,isValidNumber:R,isInt:W,isFloat:G,isBigInt:U,isNaN:q,isInfinite:H,isDefined:J,isNotDefined:Q,isFalsy:X,isTruthy:Y,isSet:Z,isMap:$,isWeakMap:_,isWeakSet:ee,isObjectOrFn:te,isArray:re,isTypedArray:ne,isAnyArray:ie,isRegExp:oe,isEmptyVal:ae,isEmptyObj:se,isPrimArray:ue,isArrayOfPrimType:ce,isSafeInteger:fe,isAsyncFunction:ye,isGeneratorFunction:le,isAsyncGeneratorFunction:pe,isPlainFunction:be}=V;var me=new Map([["function",C],["asyncfunction",ye],["generatorfunction",le],["asyncgeneratorfunction",pe],["plainfunction",be],["string",M],["number",L],["num",L],["validnumber",R],["validnum",R],["integer",W],["safeinteger",fe],["int",W],["float",G],["bigint",U],["nan",q],["infinity",H],["infinite",H],["boolean",z],["bool",z],["symbol",D],["object",K],["array",re],["null",e=>null===e],["undefined",e=>void 0===e],["defined",J],["not defined",Q],["bottomtype",Q],["empty",e=>!J(e)],["falsy",X],["truthy",Y],["set",Z],["map",$],["weakset",ee],["weakmap",_],["emptyobject",se],["empty protoless object",e=>se(e,!0)],["emptyvalue",ae],["empty",ae],["typedarray",ne],["anyarray",ie],["regexp",oe],["regex",oe],["regular expression",oe],["numberarray",function(e){return ce(e,"Number")}],["stringarray",function(e){return ce(e,"String")}],["primarray",function(e){return ue(e)}]]);Map.prototype.toString=function(e,t){var r=t?"\n":", ",n="",i=Array.from(this.keys());for(var o of(e&&i.sort(((e,t)=>e.localeCompare(t))),i))n+="'"+o+"'"+r;return t?n:n.slice(0,n.length-2)};var de=me,ge=Object.prototype.hasOwnProperty;function ve(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}var he={getAllOwnKeys:ve,hasOwn:function(e,t){return ge.call(e,t)},hasOwnStringedEnumKeys:function(e,t){for(var r of t=ve(e))if(!t.includes(r))return!1;return!0},hasOwnExactStringedEnumKeys:function(e,t){var r=ve(e);if(r.length!==t.length)return!1;for(var n of r)if(!t.includes(n))return!1;return!0}};const{hasOwn:Oe}=he;var we={validateDescriptor:function(e,t,r){return e=Object.getOwnPropertyDescriptor(e,t),!(Oe(r,"configurable")&&e.configurable!==r.configurable||Oe(r,"enumerable")&&e.enumerable!==r.enumerable||Oe(r,"writable")&&e.writable!==r.writable)}};const{hasOwn:je}=he;var ke={mergeKeyOverlap:function(e,t){for(var r in e)je(e,r)&&je(t,r)&&(e[r]=t[r]);return e}};const{isString:Se}=V;var Ae={isValidObjectMeta:function(e){return Se(e)&&"sealed"===e||"frozen"===e||"extensible"===e}};const Ee=de,Pe=t,{isPlainObject:Te,isObject:Ne,isString:Fe,isArray:xe,isObjectOrFn:Ie,isFunction:Be,isBoolean:Ve,isAnonymousFunction:Ce}=V,{hasOwn:Ke,hasOwnStringedEnumKeys:Me,hasOwnExactStringedEnumKeys:ze}=he,{protoIs:De,hasProto:Le}=e,{normalizeString:Re,capitalize:We,getType:Ge}=r,{validateDescriptor:Ue}=we,{mergeKeyOverlap:qe}=ke,{isValidObjectMeta:He}=Ae;function Je(e,t,r){return Ke(r,"type")&&!Xe(e[t],r.type)||Ke(r,"meta")&&!Ue(e,t,r.meta)||Ke(r,"value")&&(n=e[t],i=r.value,!(Be(i)?i(n):Pe.useLooseValueCompare?n==i:n===i))||Ke(r,"validator")&&!function(e,t){if(Be(t))return t(e);throw new TypeError("Invalid datatype for 'validator' property. Needs to a function. Recieved "+Ge(t)+".")}(e[t],r.validator);var n,i}function Qe(e,t){return Ke(e,t)}function Xe(e,t){if(Ce(t))return t(e);if(Be(t))return validateObjectByConstructor?e.constructor===t:e instanceof t;if(Fe(t)){t=Re(t);if(Ee.has(t))return Ee.get(t)(e);throw new TypeError("Invalid string value '"+t+"'. Allowed types (upper or lowercase):\n"+Ee.toString(!0)+"\n")}if(xe(t)){for(var[r,n]of t.entries())if(t[r]=Re(n),!Ee.has(t[r]))throw new TypeError("Invalid string value '"+t[r]+"'. Allowed types (upper or lowercase):\n"+Ee.toString(!0)+"\n");for(var n of t)if(Ee.has(n)&&Ee.get(n)(e))return!0;return!1}throw new TypeError("Schema 'type' properties needs to be either (constructor) function or (custom type) string. Received "+Ge(t)+".")}function Ye(e,t){return qe(e,Te(t)?t:{})}var Ze=Object.freeze({validateObject:function(e,t,r){if(!Te(t))throw new TypeError("The 'schema' argument needs to be an object, not "+t+" ("+Ge(t)+").");if(!Te(e))return!1;r&&Ye(Pe,r);var n=0;return function e(t,r,i){n++;var o=Ve(r.exactKeys)?r.exactKeys:Pe.exactKeys;if(Ke(r,"keys"))if(xe(r.keys)){if(o){if(!ze(t,r.keys))return!1}else if(!Me(t,r.keys))return!1}else{if(!Ne(r.keys))throw new Error("Schema 'keys' property needs to be either array or object. Recieved "+r.keys+" ("+Ge(r.keys)+").");if(o&&!ze(t,Object.keys(r.keys)))return!1;for(var i in r.keys){if(!o&&!Qe(t,i))return!1;if(Te(t[i])&&Pe.validateNestedObjects&&n<Pe.recursionLimit){if(!e(t[i],r.keys[i]))return!1}else if(Te(r.keys[i])){if(Je(t,i,r.keys[i]))return!1}else if(Fe(r.keys[i])||Be(r.keys[i])){if(!Xe(t[i],r.keys[i]))return!1}else{if(!xe(r.keys[i]))throw new TypeError("The schema properties in the 'keys' array/object needs to be either object or string. Recieved "+r.keys[i]+".");var a=!1;for(var s of r.keys[i])if(Xe(t[i],s)){a=!0;break}if(!a)return!1}}}return!!function(e,t){if(Ke(t,"proto")){if(Ie(t.proto))return De(e,t.proto);if("default"===t.proto)return De(e,Object.prototype);if(Ve(t.proto))return Le(e);throw new TypeErrror("Schema has property 'proto', but is wrong datatype (must be boolean, object, function, null or 'default')")}return!0}(t,r)&&!!function(e,t){if(Ke(t,"meta")){if(He(t.meta))return Object["is"+We(t.meta.toLowerCase())](e);throw new TypeError("The meta property only accepts a string with the values (upper or lowercase): 'frozen', 'sealed' or 'extensible' when used to validate an object.")}return!0}(t,r)}(e,t)},setOptions:Ye,addAlias:function(e,t,r){if(!Fe(e)||!Ee.has(e))return!1;if(xe(t)){for(var n of t)!Fe(n)||!r&&Ee.has(n)||Ee.set(n,Ee.get(e));return!0}return!(!Fe(t)||!r&&Ee.has(t))&&(Ee.set(t,Ee.get(e)),!0)},addValidator:function(e,t,r){return Te(e)?!Object.keys(e).forEach((n=>{if(Be(e[n])&&(r||!Ee.has(Re(n)))){var i=Re(t?t(n):n);Ee.set(i||Re(n),e[n])}})):!(!Fe(e)||!Be(t)||Ee.has(Re(e)))&&(Ee.set(Re(e),t),!0)}});return Ze}));
